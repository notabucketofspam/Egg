<hr>
<div id="other-user-displays" class="TwoColumn"></div>
<script>
/** @type number */
var generateUserDisplayTimerSetIntervalHandle;
/** @type boolean */
var generateUserDisplayFlag;
/** @type number */
var generateUserDisplayfailureMessagesSetTimeoutHandle;
/**
 * Does what you'd assume.
 */
function generateUserDisplay() {
  if (generateUserDisplayFlag)
    return;
  document.getElementById("generate-user-display-failure-messages").style.display = "none";
  let timer = 0;
  generateUserDisplayFlag = true;
  generateUserDisplayTimerSetIntervalHandle = setInterval(function(/** @type HTMLSpanElement*/ spanElement) {
    timer += frametime;
    spanElement.innerText = Math.trunc(timer);
  }, frametime, document.getElementById("generate-user-display-timer"));
  google.script.run.withSuccessHandler(function (/** @type Record<string, string>[] */ displays) {
    generateUserDisplayFlag = false;
    clearInterval(generateUserDisplayTimerSetIntervalHandle);
    document.getElementById("active-user-display").innerHTML = "";
    document.getElementById("other-user-displays").innerHTML = "";
    displays.forEach(function (display) {
      document.getElementById(display["div"]).insertAdjacentHTML("beforeend", display["content"]);
    });
    if (!calculator.optionsInitialized)
      generateCalculatorOptions();
  }).withFailureHandler(function (/** @type Error */ error) {
    generateUserDisplayFlag = false;
    clearInterval(generateUserDisplayTimerSetIntervalHandle);
    document.getElementById("generate-user-display-failure-messages").innerHtml = error.name ?
      `${error.name}<br>${error.message}<br>Press <code>ctrl + F5</code> to continue.` : String(error);
    document.getElementById("generate-user-display-failure-messages").style.display = "block";
    clearTimeout(generateUserDisplayfailureMessagesSetTimeoutHandle);
    generateUserDisplayfailureMessagesSetTimeoutHandle = setTimeout(function () {
      document.getElementById("generate-user-display-failure-messages").style.display = "none";
    }, 120000);
  }).generateUserDisplay();
}
</script>
